<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –°–ö–£–î - –ò–º–∏—Ç–∞—Ü–∏—è —Å—á–∏—Ç—ã–≤–∞—Ç–µ–ª—è</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 50px; 
            background-color: #f5f5f5;
        }
        .container { 
            max-width: 600px; 
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label { 
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        input, select, button { 
            padding: 12px; 
            margin: 5px 0; 
            width: 100%; 
            box-sizing: border-box;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        select {
            cursor: pointer;
        }
        button { 
            background-color: #007bff; 
            color: white; 
            border: none; 
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        button:hover { 
            background-color: #0056b3; 
        }
        .send-button {
            background-color: #28a745;
            font-size: 16px;
            padding: 15px;
            margin-top: 20px;
        }
        .send-button:hover {
            background-color: #218838;
        }
        .result { 
            margin-top: 20px; 
            padding: 15px; 
            background-color: #f8f9fa; 
            border: 2px solid #dee2e6;
            border-radius: 5px;
            font-weight: bold;
        }
        .success { 
            background-color: #d4edda; 
            border-color: #c3e6cb;
            color: #155724;
        }
        .error { 
            background-color: #f8d7da; 
            border-color: #f5c6cb;
            color: #721c24;
        }
        .info {
            background-color: #e7f3ff;
            border: 2px solid #b3d9ff;
            color: #0066cc;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .employee-info {
            background-color: #f0f8ff;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 12px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîë –¢–µ—Å—Ç –°–ö–£–î - –ò–º–∏—Ç–∞—Ü–∏—è —Å—á–∏—Ç—ã–≤–∞—Ç–µ–ª—è</h1>
        
                 <div class="info">
             <strong>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong><br>
             –≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∏–º–∏—Ç–∏—Ä—É–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É –¥–∞–Ω–Ω—ã—Ö –æ—Ç RFID —Å—á–∏—Ç—ã–≤–∞—Ç–µ–ª—è RC522 –Ω–∞ —Å–µ—Ä–≤–µ—Ä.<br>
             –ê–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞: <code>https://skud-ek.ru/api/attendance</code>
         </div>
        
        <div class="form-group">
            <label for="employee">üë§ –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞:</label>
            <select id="employee" onchange="updateEmployeeInfo()">
                <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ --</option>
                <option value="E9DBA5A3">–®—É—Ä–∞</option>
                <option value="992BEE97">–ü–æ–ª—è–∫–æ–≤ –ü–∞–≤–µ–ª</option>
                <option value="894046B8">–¢–∞—Ä–∞—Å–æ–≤ –ù–∏–∫–∏—Ç–∞</option>
                <option value="92C2001D">–ü–æ–ª—è–∫–æ–≤ –î–º–∏—Ç—Ä–∏–π</option>
                <option value="296DD1A3">–ü—É—â–∏–Ω—Å–∫–∏–π –ú–∞—Ä–∫</option>
                <option value="32AABBD6">–ü–æ–ª—è–∫–æ–≤ –ü–∞–≤–µ–ª (–∫–∞—Ä—Ç–∞ 2)</option>
                <option value="E79DF8A4">–ö–∞—Ä—Ç–∞ –ú–ò–† 4635</option>
                <option value="0A711B71">–ö–∞—Ä—Ç–∞ –ü—Ä–æ–∫–∞—Ç—É—Ç</option>
                <option value="083BD5D8">–¶–£–ú</option>
            </select>
            <div id="employeeInfo" class="employee-info" style="display: none;"></div>
        </div>
        
        <div class="form-group">
            <label for="time">üïê –í—Ä–µ–º—è —Å–æ–±—ã—Ç–∏—è (YYYY-MM-DD HH:MM:SS):</label>
            <input type="text" id="time" placeholder="2025-01-28 16:30:00">
            <button type="button" onclick="setCurrentTime()" style="width: auto; display: inline-block; margin-left: 10px; padding: 8px 15px;">
                –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
            </button>
        </div>
        
        <button class="send-button" onclick="sendAttendance()">
            üöÄ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ—Å—ã–ª–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        </button>
        
        <div id="result" class="result" style="display: none;"></div>
        
        <div style="margin-top: 30px; text-align: center; color: #666; font-size: 12px;">
            <p>–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è (–ø—Ä–∏—Ö–æ–¥/—É—Ö–æ–¥) –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π –∑–∞ –¥–µ–Ω—å</p>
        </div>
    </div>

    <script>
        // –î–∞–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ (—Å–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä -> –∏–º—è)
        const employees = {
            "E9DBA5A3": "–®—É—Ä–∞",
            "992BEE97": "–ü–æ–ª—è–∫–æ–≤ –ü–∞–≤–µ–ª", 
            "894046B8": "–¢–∞—Ä–∞—Å–æ–≤ –ù–∏–∫–∏—Ç–∞",
            "92C2001D": "–ü–æ–ª—è–∫–æ–≤ –î–º–∏—Ç—Ä–∏–π",
            "296DD1A3": "–ü—É—â–∏–Ω—Å–∫–∏–π –ú–∞—Ä–∫",
            "32AABBD6": "–ü–æ–ª—è–∫–æ–≤ –ü–∞–≤–µ–ª (–∫–∞—Ä—Ç–∞ 2)",
            "E79DF8A4": "–ö–∞—Ä—Ç–∞ –ú–ò–† 4635",
            "0A711B71": "–ö–∞—Ä—Ç–∞ –ü—Ä–æ–∫–∞—Ç—É—Ç", 
            "083BD5D8": "–¶–£–ú"
        };
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        function setCurrentTime() {
            const now = new Date();
            const timeString = now.getFullYear() + '-' + 
                String(now.getMonth() + 1).padStart(2, '0') + '-' + 
                String(now.getDate()).padStart(2, '0') + ' ' + 
                String(now.getHours()).padStart(2, '0') + ':' + 
                String(now.getMinutes()).padStart(2, '0') + ':' + 
                String(now.getSeconds()).padStart(2, '0');
            document.getElementById('time').value = timeString;
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–µ
        function updateEmployeeInfo() {
            const select = document.getElementById('employee');
            const infoDiv = document.getElementById('employeeInfo');
            
            if (select.value) {
                const employeeName = employees[select.value];
                infoDiv.innerHTML = `<strong>–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã:</strong> ${select.value}<br><strong>–ò–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞:</strong> ${employeeName}`;
                infoDiv.style.display = 'block';
            } else {
                infoDiv.style.display = 'none';
            }
        }
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        setCurrentTime();
        
        // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        console.log('üîç DEBUG: –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
        console.log('üîç DEBUG: Protocol:', window.location.protocol);
        console.log('üîç DEBUG: Host:', window.location.host);
        console.log('üîç DEBUG: Origin:', window.location.origin);
        console.log('üîç DEBUG: User Agent:', navigator.userAgent);
        console.log('üîç DEBUG: –û–Ω–ª–∞–π–Ω:', navigator.onLine);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–π
        console.log('üîç DEBUG: fetch –¥–æ—Å—Ç—É–ø–µ–Ω:', typeof fetch !== 'undefined');
        console.log('üîç DEBUG: JSON –¥–æ—Å—Ç—É–ø–µ–Ω:', typeof JSON !== 'undefined');
        
        // –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ CORS
        console.log('üîç DEBUG: –¢–µ—Å—Ç–∏—Ä—É–µ–º CORS –ø–æ–ª–∏—Ç–∏–∫—É...');
        fetch('https://skud-ek.ru/api/health', { method: 'GET' })
            .then(response => {
                console.log('üîç DEBUG: Health check —É—Å–ø–µ—à–µ–Ω, CORS —Ä–∞–±–æ—Ç–∞–µ—Ç');
                console.log('üîç DEBUG: Health response status:', response.status);
            })
            .catch(error => {
                console.log('üîç DEBUG: Health check –Ω–µ—É–¥–∞—á–µ–Ω');
                console.log('üîç DEBUG: Health error:', error.message);
                if (error.message.includes('Failed to fetch')) {
                    console.log('üîç DEBUG: CORS –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–∞–∂–µ GET –∑–∞–ø—Ä–æ—Å—ã');
                }
            });
        
        function sendAttendance() {
            const employeeSelect = document.getElementById('employee');
            const timeInput = document.getElementById('time');
            
            const serial = employeeSelect.value;
            const time = timeInput.value;
            
            if (!serial) {
                showResult('‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞', 'error');
                return;
            }
            
            if (!time) {
                showResult('‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤—Ä–µ–º—è', 'error');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏
            const timeRegex = /^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/;
            if (!timeRegex.test(time)) {
                showResult('‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: YYYY-MM-DD HH:MM:SS', 'error');
                return;
            }
            
            const employeeName = employees[serial];
            sendToServer(serial, time, employeeName);
        }
        
        function sendToServer(serial, time, employeeName) {
            const data = {
                serial: serial,
                time: time
            };
            
            // –î–µ—Ç–∞–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞
            console.log('üîç DEBUG: –ù–∞—á–∏–Ω–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É –¥–∞–Ω–Ω—ã—Ö');
            console.log('üîç DEBUG: URL:', 'https://skud-ek.ru/api/attendance');
            console.log('üîç DEBUG: –ú–µ—Ç–æ–¥:', 'POST');
            console.log('üîç DEBUG: –î–∞–Ω–Ω—ã–µ:', data);
            console.log('üîç DEBUG: JSON:', JSON.stringify(data));
            console.log('üîç DEBUG: User Agent:', navigator.userAgent);
            console.log('üîç DEBUG: –ë—Ä–∞—É–∑–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç fetch:', typeof fetch !== 'undefined');
            
            showResult(`‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è ${employeeName}...`, '');
            
            // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∏–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–æ—Å—Ç—ã–º –∑–∞–ø—Ä–æ—Å–æ–º
            console.log('üîç DEBUG: –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞...');
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
            console.log('üîç DEBUG: –í—ã–ø–æ–ª–Ω—è–µ–º fetch –∑–∞–ø—Ä–æ—Å...');
            fetch('https://skud-ek.ru/api/attendance', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                console.log('üîç DEBUG: –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
                console.log('üîç DEBUG: Response status:', response.status);
                console.log('üîç DEBUG: Response statusText:', response.statusText);
                console.log('üîç DEBUG: Response headers:', [...response.headers.entries()]);
                console.log('üîç DEBUG: Response ok:', response.ok);
                console.log('üîç DEBUG: Response type:', response.type);
                console.log('üîç DEBUG: Response url:', response.url);
                
                if (!response.ok) {
                    console.log('üîç DEBUG: Response –Ω–µ OK, –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É');
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                console.log('üîç DEBUG: –ü–∞—Ä—Å–∏–º JSON...');
                return response.json();
            })
            .then(data => {
                console.log('üîç DEBUG: JSON —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω');
                console.log('üîç DEBUG: –î–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç–∞:', data);
                console.log('üîç DEBUG: –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö:', typeof data);
                console.log('üîç DEBUG: –°—Ç–∞—Ç—É—Å –≤ –¥–∞–Ω–Ω—ã—Ö:', data.status);
                
                if (data.status === 'success') {
                    console.log('üîç DEBUG: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç');
                    const message = `‚úÖ <strong>–£—Å–ø–µ—à–Ω–æ!</strong><br>
                        –°–æ—Ç—Ä—É–¥–Ω–∏–∫: <strong>${data.employee}</strong><br>
                        –°–æ–±—ã—Ç–∏–µ: <strong>${data.event}</strong><br>
                        –í—Ä–µ–º—è: <strong>${data.time}</strong><br>
                        –î–∞—Ç–∞: <strong>${data.date}</strong>`;
                    showResult(message, 'success');
                } else if (data.status === 'unknown') {
                    console.log('üîç DEBUG: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—É—é –∫–∞—Ä—Ç—É');
                    const message = `‚ùì <strong>–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞</strong><br>
                        –°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä: <strong>${serial}</strong><br>
                        –ö–∞—Ä—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤.`;
                    showResult(message, 'error');
                } else {
                    console.log('üîç DEBUG: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—à–∏–±–∫—É —Å–µ—Ä–≤–µ—Ä–∞');
                    const message = `‚ùå <strong>–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞:</strong><br>${data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`;
                    showResult(message, 'error');
                }
            })
            .catch(error => {
                console.log('üîç DEBUG: –ü–æ–ø–∞–ª–∏ –≤ catch –±–ª–æ–∫');
                console.error('üîç DEBUG: –ü–æ–ª–Ω–∞—è –æ—à–∏–±–∫–∞:', error);
                console.error('üîç DEBUG: –û—à–∏–±–∫–∞ name:', error.name);
                console.error('üîç DEBUG: –û—à–∏–±–∫–∞ message:', error.message);
                console.error('üîç DEBUG: –û—à–∏–±–∫–∞ stack:', error.stack);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫
                let errorType = 'unknown';
                if (error.name === 'TypeError' && error.message.includes('Failed to fetch')) {
                    errorType = 'fetch_failed';
                    console.log('üîç DEBUG: –¢–∏–ø –æ—à–∏–±–∫–∏: Failed to fetch (–≤–µ—Ä–æ—è—Ç–Ω–æ CORS –∏–ª–∏ —Å–µ—Ç—å)');
                } else if (error.message.includes('CORS')) {
                    errorType = 'cors';
                    console.log('üîç DEBUG: –¢–∏–ø –æ—à–∏–±–∫–∏: CORS');
                } else if (error.message.includes('Network')) {
                    errorType = 'network';
                    console.log('üîç DEBUG: –¢–∏–ø –æ—à–∏–±–∫–∏: Network');
                }
                
                console.log('üîç DEBUG: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —Ç–∏–ø –æ—à–∏–±–∫–∏:', errorType);
                
                let errorMessage = `‚ùå <strong>–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:</strong><br>${error.message}`;
                
                if (errorType === 'fetch_failed') {
                    errorMessage += '<br><br>üí° <em>–°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ CORS –ø–æ–ª–∏—Ç–∏–∫–∞ –±—Ä–∞—É–∑–µ—Ä–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å.</em>';
                    errorMessage += '<br>üí° <em>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å curl –∏–ª–∏ Python —É—Ç–∏–ª–∏—Ç—É.</em>';
                } else if (error.message.includes('CORS')) {
                    errorMessage += '<br><br>üí° <em>–í–æ–∑–º–æ–∂–Ω–æ, —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω CORS –ø–æ–ª–∏—Ç–∏–∫–æ–π –±—Ä–∞—É–∑–µ—Ä–∞.</em>';
                } else if (error.message.includes('fetch')) {
                    errorMessage += '<br><br>üí° <em>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É skud-ek.ru</em>';
                }
                
                showResult(errorMessage, 'error');
            });
        }
        
        function showResult(message, type) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = message;
            resultDiv.className = 'result ' + type;
            resultDiv.style.display = 'block';
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
    </script>
</body>
</html> 