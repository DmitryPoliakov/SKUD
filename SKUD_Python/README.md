# СКУД - Система контроля и учета доступа на Python

Система контроля и учета доступа (СКУД) с использованием ESP32 и RFID-считывателя RC522, с серверной частью на Python и телеграм-ботом для отчетов.

## Структура проекта

```
SKUD_Python/
├── app/                        # Директория с приложением
│   ├── __init__.py            # Инициализация пакета Python
│   ├── main.py                # Flask API для обработки запросов от ESP32
│   ├── telegram_bot.py        # Телеграм-бот для выгрузки отчетов
│   └── auto_close.py          # Скрипт для автоматического закрытия незавершенных дней
├── data/                       # Директория для хранения данных
│   ├── attendance.csv         # Файл с данными посещаемости
│   ├── employees.json         # Файл со списком сотрудников
│   └── reports/               # Директория для сгенерированных отчетов
├── RFID_RC522_Tracker_Python.ino  # Скетч для ESP32 с RC522
├── requirements.txt           # Зависимости Python
├── run.py                     # Скрипт для запуска всех компонентов
└── README.md                  # Документация проекта
```

## Возможности системы

- **Учет посещаемости**: регистрация прихода и ухода сотрудников по RFID-картам
- **Телеграм-бот**: удобный интерфейс для получения отчетов
- **Выгрузка отчетов**: экспорт данных в Excel с детальной информацией и сводной статистикой
- **Визуализация**: графики отработанных часов
- **Автоматическое закрытие дней**: система автоматически закрывает незавершенные дни

## Установка и настройка

### Требования

- Python 3.8 или выше
- ESP32 с подключенным RFID-считывателем RC522
- Доступ к Telegram API (для создания бота)

### Установка зависимостей

```bash
pip install -r requirements.txt
```

### Настройка ESP32

1. Откройте файл `RFID_RC522_Tracker_Python.ino` в Arduino IDE
2. Установите библиотеки:
   - WiFi
   - HTTPClient
   - ArduinoJson
   - MFRC522
3. Настройте WiFi параметры и URL сервера:
   ```cpp
   const char* primary_ssid = "ваш_ssid";
   const char* primary_password = "ваш_пароль";
   const char* serverURL = "http://ваш_ip:5000/api/attendance";
   ```
4. Загрузите скетч в ESP32

### Настройка телеграм-бота

1. Создайте бота через @BotFather в Telegram
2. Получите токен бота
3. Откройте файл `app/telegram_bot.py` и замените:
   ```python
   TELEGRAM_TOKEN = "YOUR_TELEGRAM_BOT_TOKEN"  # Замените на свой токен
   ALLOWED_USERS = []  # Добавьте ID пользователей, которым разрешен доступ
   ```

## Запуск системы

```bash
python run.py
```

Это запустит:
- Flask API на порту 5000
- Телеграм-бота
- Планировщик для автоматического закрытия дней

## Использование телеграм-бота

1. Найдите своего бота в Telegram
2. Отправьте команду `/start` для начала работы
3. Используйте `/report` для получения отчета за текущий или предыдущий месяц

## Схема подключения RC522 к ESP32

```
+-----------+----------------+
| RC522     | ESP32-C3       |
+-----------+----------------+
| SDA (SS)  | GPIO6 (D4)     |
| SCK       | GPIO8 (D8)     |
| MOSI      | GPIO10 (D10)   |
| MISO      | GPIO9 (D9)     |
| GND       | GND            |
| RST       | GPIO7 (D5)     |
| 3.3V      | 3V3            |
+-----------+----------------+
```

## Автоматическое закрытие дней

Система автоматически закрывает незавершенные дни (записи с приходом, но без ухода) в 00:01 следующего дня, устанавливая время ухода по умолчанию (17:00).

## Формат данных

### attendance.csv
```
date,employee,arrival,departure
2023-07-01,Иванов,09:15,17:30
2023-07-01,Петров,08:45,18:00
```

### employees.json
```json
{
  "992BEE97": "Поляков",
  "894046B8": "Тарасов"
}
```

## Лицензия

MIT 